

# jwks-rsa

[![CircleCI](https://circleci.com/gh/auth0/jwks-rsa-java.svg?style=svg)](https://circleci.com/gh/auth0/jwks-rsa-java)
[![Maven Central](https://img.shields.io/maven-central/v/com.auth0/jwks-rsa.svg)](http://search.maven.org/#search%7Cga%7C1%7Cg%3A%20com.auth0%20a%3Ajwks-rsa)

Library for obtaining JWT keys definitions from an Authorization Server, so that JSON Web Tokens signatures can be validated.

## Install

### Maven

```xml
<dependency>
    <groupId>com.auth0</groupId>
    <artifactId>jwks-rsa</artifactId>
    <version>1.0.0</version>
</dependency>
```

### Gradle

```gradle
implementation 'com.auth0:jwks-rsa:1.0.0'
```

## Usage

The JSON Web Tokens are issued by the Authorization Server. Tokens consists of three parts:

 * header
 * body
 * signature

The signature is generated by a Private Key known only to the Authorization Server. The corresponding [key id](https://tools.ietf.org/html/rfc7515#section-4.1.4) is stored in the token header `kid` property:

```json
{
  "typ": "JWT",
  "alg": "RS256",
  "kid": "key_id_1"
}
```

In order to facilitate token validation, the Authorization Server publishes a list of keys it has used to sign tokens:

```json
{
  "keys": [
    {
      "kid": "key_id_1"
      ...
    },
    {
      "kid": "key_id_2"
      ...
    }
    ..
  ]
}
```
The above key definitions includes details on the key's Public Keys. So when the [Resource Server]([https://www.oauth.com/oauth2-servers/the-resource-server/](https://www.oauth.com/oauth2-servers/the-resource-server/)) then gets hold of this list it can check if the token key id is known and then whether the signature is valid.

This library facilitates obtaining this list of keys from the Authorization Server.

### JwkProviderBuilder
Use the `JwkProviderBuilder` to obtain an instance of `JwkProvider`:

```java
URL url = new URL("https://samples.auth0.com/");
JwkProvider provider = new JwkProviderBuilder(url).build();
Jwk key = provider.getJwk("my.kid");
```

The builder supports the following features:

 * caching (enabled by default)
 * rate-limiting (enabled by default)
 * retrying on transient network issues (once)
 * extended cache time-to-live on outage
 * preemptive cache update (in background thread)

Example using all features, with default values:

```java
URL url = new URL("https://samples.auth0.com/");
JwkProvider provider = new JwkProviderBuilder(url)
        .cached(10, TimeUnit.HOURS, 15, TimeUnit.SECONDS) // cache hold time, cache refresh deadline
        .rateLimited(10, 1, TimeUnit.MINUTES)
        .outageCached(24, TimeUnit.HOURS)
        .preemptiveCacheUpdate(15, TimeUnit.SECONDS)
        .retrying(true)
        .build();
```

### JwkProviders
The underlying implementation contains several `JwkProviders`, some which also are instances of `JwkProvider`.

#### UrlJwksProvider

`UrlJwksProvider` fetches a list of JWKs from an URL.

```java
URL url = new URL("https://samples.auth0.com/");
JwksProvider jwksProvider = new UrlJwksProvider(url);
List<Jwk> jwks = jwksProvider.getJwks(); // throws JwtException when not found or can't get one
```

#### CachedJwksProvider

`CachedJwksProvider` caches a `JwksProvider`.

> By default it stores the keys for 10 hours but these values can be changed

```java
JwksProvider http = new UrlJwksProvider("https://samples.auth0.com/");
JwksProvider jwksProvider = new CachedJwksProvider(http);
```

The implementation blocks so that a single thread is responsible for updating the cache at a time.

#### PreemptiveCachedJwksProvider

`PreemptiveCachedJwksProvider` works like `CachedJwksProvider`, but in addition preemptively updates the cache in a background thread if invoked right before the cache time-to-live is reached. This prevents thread congestion (blocking wait) when the cache actually expires.

#### RateLimitJwksProvider

`RateLimitJwskProvider` wraps a provider to limit the number of times it is invoked.

> By default the rate is limited to 10 per minute, but these values can be changed

```java
URL url = new URL("https://samples.auth0.com/");
JwksProvider http = new UrlJwksProvider(url);
Bucket bucket = new Bucket(10, 1, TimeUnit.MINUTES);
JwksProvider provider = new RateLimitJwksProvider(http, bucket);
```

#### RetryingJwksProvider

`RetryingJwksProvider` wraps a provider to retry once when keys are reported as unavailable; this is usually triggered by an `IOException`.

This is a workaround for transient network problems.

#### OutageCachedJwksProvider

`OutageCachedJwksProvider` wraps a provider to transparently cache keys. If the wrapped provider reports the keys as unavailable, the outage provider returns its cached instance untill it expires.

This is a workaround for temporary network problems / outage stretching for minutes or hours.

## What is Auth0?

Auth0 helps you to:

* Add authentication with [multiple authentication sources](https://docs.auth0.com/identityproviders), either social like **Google, Facebook, Microsoft Account, LinkedIn, GitHub, Twitter, Box, Salesforce, amont others**, or enterprise identity systems like **Windows Azure AD, Google Apps, Active Directory, ADFS or any SAML Identity Provider**.
* Add authentication through more traditional **[username/password databases](https://docs.auth0.com/mysql-connection-tutorial)**.
* Add support for **[linking different user accounts](https://docs.auth0.com/link-accounts)** with the same user.
* Support for generating signed [Json Web Tokens](https://docs.auth0.com/jwt) to call your APIs and **flow the user identity** securely.
* Analytics of how, when and where users are logging in.
* Pull data from other sources and add it to the user profile, through [JavaScript rules](https://docs.auth0.com/rules).

## Create a free Auth0 Account

1. Go to [Auth0](https://auth0.com) and click Sign Up.
2. Use Google, GitHub or Microsoft Account to login.

## Issue Reporting

If you have found a bug or if you have a feature request, please report them at this repository issues section. Please do not report security vulnerabilities on the public GitHub issue tracker. The [Responsible Disclosure Program](https://auth0.com/whitehat) details the procedure for disclosing security issues.

## Author

[Auth0](https://auth0.com)

## License

This project is licensed under the MIT license. See the [LICENSE](LICENSE) file for more info.
